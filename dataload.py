"""
1 1 3
[0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,1,0,0]
2 1 1
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,0,1          ,0,0,0,0,1]
3 1 1
[0,0,0,0,0    ,0,0,0,0,0,   0,1,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
2 2 3
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,1,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,1,0          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,1,0          ,0,0,1,0,0]
4 1 2
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
2 3 5
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,1,0,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,1,0,0          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,1,0,0          ,0,0,1,0,0]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,1,0,0          ,0,1,0,0,0]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,1,0,0          ,1,0,0,0,0]
5 1 2
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
1 2 3 
[0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,1,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,1,0          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,1,0          ,0,0,1,0,0]
6 1 3
[0,0,0,0,0    ,0,0,0,1,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,1,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,0,1,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,1,0,0]
7 1 5
[0,0,0,0,0    ,0,0,1,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,1,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,1,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,1,0,0]
[0,0,0,0,0    ,0,0,1,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,1,0,0,0]
[0,0,0,0,0    ,0,0,1,0,0,   0,0,0,0         ,0,0,0,0,1          ,1,0,0,0,0]
8 1 3
[0,0,0,0,0    ,0,1,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,0    ,0,1,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,0,0,0    ,0,1,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,1,0,0]
9 1 5
[0,0,0,0,0    ,1,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,0    ,1,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,0,0,0    ,1,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,1,0,0]
[0,0,0,0,0    ,1,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,1,0,0,0]
[0,0,0,0,0    ,1,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,1,0,0,0,0]
4 2 2
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,1,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,1,0          ,0,0,0,1,0]
4 3 5
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,1,0,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,1,0,0          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,1,0,0          ,0,0,1,0,0]
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,1,0,0          ,0,1,0,0,0]
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,1,0,0          ,1,0,0,0,0]
10 1 5
[0,0,0,0,1    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,0,1    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,0,0,1    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,1,0,0]
[0,0,0,0,1    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,1,0,0,0]
[0,0,0,0,1    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,1,0,0,0,0]
11 1 3
[0,0,0,1,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,0,1,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,0,1,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,1,0,0]
5 2 4
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,0,1,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,0,1,0          ,0,0,0,1,0]
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,0,1,0          ,0,0,1,0,0]
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,0,1,0          ,0,1,0,0,0]
3 2 1
[0,0,0,0,0    ,0,0,0,0,0,   0,1,0,0         ,0,0,0,1,0          ,0,0,0,0,1]
3 3 1
[0,0,0,0,0    ,0,0,0,0,0,   0,1,0,0         ,0,0,1,0,0          ,0,0,0,0,1]
3 4 1
[0,0,0,0,0    ,0,0,0,0,0,   0,3,0,0         ,0,1,0,0,0          ,0,0,0,0,1]
5 3 2
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,1,0,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,1,   0,0,0,0         ,0,0,1,0,0          ,0,0,0,1,0]
12 1 5
[0,0,1,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
[0,0,1,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0]
[0,0,1,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,1,0,0]
[0,0,1,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,1,0,0,0]
[0,0,1,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,1,0,0,0,0]
13 1 1
[0,1,0,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]
13 2 4
[0,1,0,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,1,0          ,0,0,0,0,1]
[0,1,0,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,1,0          ,0,0,0,1,0]
[0,1,0,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,1,0          ,0,0,1,0,0]
[0,1,0,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,1,0          ,0,1,0,0,0]
4 4 2
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,1,0,0,0          ,0,0,0,0,1]
[0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,1,0,0,0          ,0,0,0,1,0]
2 4 1
[0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,1,0,0,0          ,0,0,0,0,1]
3 5 1
[0,0,0,0,0    ,0,0,0,0,0,   0,1,0,0         ,1,0,0,0,0          ,0,0,0,0,1]

"""
import re
import os
import numpy as np
import random
import cv2
one_mlabel = np.array([1,1,1,1,1,  1,1,1,1,1,  1,1,1,1,   1,1,1,1,1  ,0,0,0,0,0])
one_clabel = np.array([1,1,1,1,1,  1,1,1,1,1,  1,1,1,1,   0,0,0,0,0  ,0,0,0,0,0])
images = []
labels = []
tm_labels = []
tc_labels = []
mlabels = []
clabels = []
test_images = []
test_labels = []
index1 = 0
index = 0
def load_file_list():
	global images
	global labels;global mlabels;global clabels
	print("load in!")

	directory = './trainingset/train1/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,0,0,1])


	directory = './trainingset/train2/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,0,1,0])


	directory = './trainingset/train3/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,1,0,0])


	directory = './trainingset/train4/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,0,1          ,0,0,0,0,1])


	directory = './trainingset/train6/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,1,0          ,0,0,0,0,1])


	directory = './trainingset/train7/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,1,0          ,0,0,0,1,0])



	directory = './trainingset/train8/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1])


	directory = './trainingset/train5/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,1,0,0         ,0,0,0,0,1          ,0,0,0,0,1])


	directory = './trainingset/train9/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)

			labels.append([0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0])


	directory = './trainingset/train10/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
			images.append(directory+filename)
			labels.append([1,0,0,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1])


	print(len(images))
	zipped = zip(images,labels)
	random.shuffle(zipped)
	images,labels = zip(*zipped);print('load down')
	return len(images)

def load_test_list():
	global test_images
	global test_labels;global tm_labels;global tc_labels

	directory = './testingset/test1/'
	for filename in [y for y in os.listdir(directory)]:
		#print("%s%s"%(directory,filename));img = cv2.imread("%s%s"%(directory,filename))
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d2\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,0,0,1]);

	directory = './testingset/test2/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,0,1,0]);

	directory = './testingset/test3/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,0,1         ,0,0,0,0,1          ,0,0,1,0,0]);

	directory = './testingset/test4/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,0,1          ,0,0,0,0,1]);



	directory = './testingset/test6/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,1,0          ,0,0,0,0,1]);

	directory = './testingset/test7/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,0,1,0         ,0,0,0,1,0          ,0,0,0,1,0]);
	directory = './testingset/test8/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]);


	directory = './testingset/test5/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   0,1,0,0         ,0,0,0,0,1          ,0,0,0,0,1]);


	directory = './testingset/test9/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([0,0,0,0,0    ,0,0,0,0,0,   1,0,0,0         ,0,0,0,0,1          ,0,0,0,1,0])

	directory = './testingset/test10/'
	for filename in [y for y in os.listdir(directory)]:
		mat = re.match("\d\d\D+",filename)
		mat1 = re.match("\d1\d\D+",filename)
		mat2 = re.match("1\d\d\D+",filename)
		mat3 = re.match("1\d1\d",filename)
		if mat or mat1 or mat2 or mat3:
				test_images.append(directory+filename)
				test_labels.append([1,0,0,0,0    ,0,0,0,0,0,   0,0,0,0         ,0,0,0,0,1          ,0,0,0,0,1]);

	zipped = zip(test_images,test_labels)
	random.shuffle(zipped)
	test_images,test_labels = zip(*zipped);print('load down')
	return 	len(test_images)


def get_batch(batch_size):
	global index;global images;global labels
	Max_couter = len(images)
	Max_index = Max_couter//batch_size
	index = index%Max_index
	imgs =[];label=[]
	for q in range(index*batch_size,(index+1)*batch_size):
		imgs.append(cv2.imread(images[q]).reshape([3,48,48]))
		label.append(labels[q])
	mlabel = label&one_mlabel
	clabel = label&one_clabel
	index = (index+1)%Max_index
	if index == 0:
		zipped = zip(images,labels)
		random.shuffle(zipped)
		images,labels = zip(*zipped)
	return imgs,label,mlabel,clabel


def get_test(batch_size):
	global index1;global test_images;global test_labels
	Max_couter = len(test_images)
	Max_index = Max_couter//batch_size
	index1 = index1%Max_index
	window = [x for x in range(index1*batch_size,(index1+1)*batch_size)]
	imgs = [cv2.imread(test_images[q]).reshape([3,48,48]) for q in window]
	label = [test_labels[q] for q in window];tm_label = label&one_mlabel
	tc_label = label&one_clabel
	index1 = (index1+1)%Max_index
	return imgs,label,tm_label,tc_label




